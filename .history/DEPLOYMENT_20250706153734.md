# AI å·¥å…·é›† Docker éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ Docker å’Œ Docker Compose è¿›è¡Œå®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ”¯æŒå‰ç«¯(Next.js)å’Œåç«¯(Flask)çš„å®Œæ•´éƒ¨ç½²ã€‚

## ğŸ—ï¸ æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Nginx       â”‚    â”‚   Frontend      â”‚    â”‚    Backend      â”‚
â”‚   (åå‘ä»£ç†)     â”‚â”€â”€â”€â”€â”‚   (Next.js)     â”‚â”€â”€â”€â”€â”‚    (Flask)      â”‚
â”‚   Port: 443     â”‚    â”‚   Port: 3003    â”‚    â”‚   Port: 8003    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### 1. ç¯å¢ƒè¦æ±‚

- Docker 20.10+
- Docker Compose 2.0+
- æœåŠ¡å™¨å†…å­˜: æœ€å°‘ 2GB æ¨è 4GB
- ç£ç›˜ç©ºé—´: æœ€å°‘ 5GB

### 2. å…‹éš†é¡¹ç›®

```bash
git clone <your-repo-url>
cd ai-tools
```

### 3. ä¸€é”®éƒ¨ç½²

```bash
# ç»™éƒ¨ç½²è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh

# å®Œæ•´éƒ¨ç½²ï¼ˆæ„å»ºé•œåƒ + å¯åŠ¨æœåŠ¡ï¼‰
./deploy.sh deploy
```

### 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy.sh status

# å¥åº·æ£€æŸ¥
./deploy.sh health

# æŸ¥çœ‹æ—¥å¿—
./deploy.sh logs
```

## ğŸ”§ è¯¦ç»†éƒ¨ç½²æ­¥éª¤

### 1. æ„å»º Docker é•œåƒ

```bash
# æ„å»ºæ‰€æœ‰é•œåƒ
./deploy.sh build

# æˆ–è€…æ‰‹åŠ¨æ„å»º
docker-compose build --no-cache
```

### 2. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./deploy.sh up

# æˆ–è€…æ‰‹åŠ¨å¯åŠ¨
docker-compose up -d
```

### 3. é…ç½® Nginx

#### å®‰è£… Nginx (å¦‚æœæœªå®‰è£…)

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install nginx

# CentOS/RHEL
sudo yum install nginx
```

#### é…ç½®ç«™ç‚¹

```bash
# å¤åˆ¶Nginxé…ç½®æ–‡ä»¶
sudo cp nginx.conf /etc/nginx/sites-available/ai.jarvismedical.asia

# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/ai.jarvismedical.asia /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

### 4. SSL è¯ä¹¦é…ç½®

#### ä½¿ç”¨ Let's Encrypt (æ¨è)

```bash
# å®‰è£…Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d ai.jarvismedical.asia

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œ:
# 0 12 * * * /usr/bin/certbot renew --quiet
```

#### æ‰‹åŠ¨ SSL è¯ä¹¦

å¦‚æœæ‚¨æœ‰è‡ªå·±çš„ SSL è¯ä¹¦ï¼Œè¯·å°†è¯ä¹¦æ–‡ä»¶æ”¾ç½®åœ¨ï¼š

- è¯ä¹¦æ–‡ä»¶: `/etc/ssl/certs/ai.jarvismedical.asia.crt`
- ç§é’¥æ–‡ä»¶: `/etc/ssl/private/ai.jarvismedical.asia.key`

## ğŸ“Š æœåŠ¡ç®¡ç†

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./deploy.sh status

# é‡å¯æœåŠ¡
./deploy.sh restart

# åœæ­¢æœåŠ¡
./deploy.sh down

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
./deploy.sh logs

# å¥åº·æ£€æŸ¥
./deploy.sh health

# æ¸…ç†èµ„æº
./deploy.sh cleanup
```

### Docker Compose å‘½ä»¤

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f [service_name]

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart [service_name]

# è¿›å…¥å®¹å™¨
docker-compose exec [service_name] bash
```

## ğŸ” æ•…éšœæ’é™¤

### 1. æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tulpn | grep :3003
sudo netstat -tulpn | grep :8003

# æ£€æŸ¥DockerçŠ¶æ€
sudo systemctl status docker
```

### 2. å‰ç«¯æ— æ³•è®¿é—®åç«¯

```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network ls
docker network inspect ai-tools_ai-tools-network

# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker-compose exec frontend env | grep API
```

### 3. Nginx ä»£ç†é”™è¯¯

```bash
# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/nginx/ai.jarvismedical.asia.error.log

# æ£€æŸ¥ä¸Šæ¸¸æœåŠ¡
curl http://localhost:3003/health
curl http://localhost:8003/health
```

### 4. SSL è¯ä¹¦é—®é¢˜

```bash
# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
openssl x509 -in /etc/ssl/certs/ai.jarvismedical.asia.crt -text -noout

# æµ‹è¯•SSLè¿æ¥
openssl s_client -connect ai.jarvismedical.asia:443
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. Docker ä¼˜åŒ–

```bash
# æ¸…ç†æ— ç”¨é•œåƒ
docker system prune -a

# é™åˆ¶å®¹å™¨èµ„æº
# åœ¨docker-compose.ymlä¸­æ·»åŠ :
# deploy:
#   resources:
#     limits:
#       memory: 512M
#       cpus: '0.5'
```

### 2. Nginx ä¼˜åŒ–

```nginx
# åœ¨nginx.confä¸­è°ƒæ•´ä»¥ä¸‹å‚æ•°:
worker_processes auto;
worker_connections 1024;
keepalive_timeout 65;
client_max_body_size 10M;
```

### 3. åº”ç”¨ä¼˜åŒ–

- å‰ç«¯: å¯ç”¨ Next.js çš„é™æ€å¯¼å‡ºå’Œç¼“å­˜
- åç«¯: é…ç½® Flask çš„ç”Ÿäº§ç¯å¢ƒè®¾ç½®
- æ•°æ®åº“: å¦‚æœä½¿ç”¨æ•°æ®åº“ï¼Œé…ç½®è¿æ¥æ± 

## ğŸ” å®‰å…¨é…ç½®

### 1. é˜²ç«å¢™è®¾ç½®

```bash
# åªå…è®¸å¿…è¦ç«¯å£
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS
sudo ufw enable
```

### 2. å®¹å™¨å®‰å…¨

- ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œå®¹å™¨
- å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ
- æ‰«æé•œåƒæ¼æ´

### 3. æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½è„šæœ¬ç¤ºä¾‹
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
docker-compose exec backend tar -czf /tmp/backup_$DATE.tar.gz /app/data
docker cp ai-tools-backend:/tmp/backup_$DATE.tar.gz ./backups/
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ—¥å¿—: `./deploy.sh logs`
2. æ£€æŸ¥å¥åº·çŠ¶æ€: `./deploy.sh health`
3. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
4. æäº¤ Issue åˆ°é¡¹ç›®ä»“åº“

## ğŸ”„ æ›´æ–°éƒ¨ç½²

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°æ„å»ºå’Œéƒ¨ç½²
./deploy.sh deploy

# æˆ–è€…åˆ†æ­¥æ‰§è¡Œ
./deploy.sh down
./deploy.sh build
./deploy.sh up
```

## ğŸ“‹ è®¿é—®åœ°å€

- ç”Ÿäº§ç¯å¢ƒ: https://ai.jarvismedical.asia
- å‰ç«¯æœåŠ¡: http://localhost:3003
- åç«¯æœåŠ¡: http://localhost:8003
- å¥åº·æ£€æŸ¥: https://ai.jarvismedical.asia/health
