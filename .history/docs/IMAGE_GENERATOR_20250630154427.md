# AI 图像生成工具使用说明

## 功能概述

AI 图像生成工具基于 Flux Kontext 模型，提供文生图和图生图功能，支持高质量的图像生成和编辑。

## 功能特性

### 1. 文生图 (Text-to-Image)

- 通过文字描述生成图像
- 支持多种纵横比选择
- 可调节引导比例参数

### 2. 图生图 (Image-to-Image)

- 基于上传图片进行编辑
- 通过文字描述指导图像变换
- 保持原图结构进行风格转换

### 3. 高级设置

- **纵横比选择**: 1:1, 4:3, 3:4, 16:9, 9:16
- **引导比例**: 1-10 可调，控制 AI 对提示词的遵循程度
- **输出格式**: JPEG/PNG

## 环境配置

### 1. 获取 FAL API 密钥

1. 访问 [fal.ai](https://fal.ai/) 注册账号
2. 在个人设置中获取 API 密钥

### 2. 设置环境变量

```bash
# 在backend目录下设置环境变量
export FAL_KEY="your_fal_api_key_here"

# 或者在.env文件中添加（需要手动创建）
echo "FAL_KEY=your_fal_api_key_here" > .env
```

## 使用方法

### 启动服务

```bash
# 启动完整服务
./start.sh

# 或分别启动
# 后端 (端口8003)
cd backend && source venv/bin/activate && python run.py

# 前端 (端口3003)
cd frontend && npm run dev
```

### 访问界面

1. 打开浏览器访问 `http://localhost:3003`
2. 点击"AI 图像生成"工具卡片
3. 选择"文生图"或"图生图"标签
4. 输入提示词并调节参数
5. 点击生成按钮

## API 接口

### 文生图 API

```
POST /api/image-generation/text-to-image

参数:
- prompt: 文字描述 (必需)
- aspect_ratio: 纵横比 (可选，默认1:1)
- guidance_scale: 引导比例 (可选，默认3.5)
- num_images: 生成数量 (可选，默认1)
- output_format: 输出格式 (可选，默认jpeg)
```

### 图生图 API

```
POST /api/image-generation/image-to-image

参数:
- prompt: 文字描述 (必需)
- image_url: 原图URL (必需)
- aspect_ratio: 纵横比 (可选，默认1:1)
- guidance_scale: 引导比例 (可选，默认3.5)
- num_images: 生成数量 (可选，默认1)
- output_format: 输出格式 (可选，默认jpeg)
```

### 图片上传 API

```
POST /api/image-generation/upload-image

文件上传接口，返回图片URL供图生图使用
```

## 技术架构

### 前端

- **框架**: Next.js 15.3.4 + React 19
- **样式**: Tailwind CSS 4.1 + 磨砂玻璃拟态设计
- **交互**: framer-motion 动画
- **组件**:
  - `ImageGenerator.tsx`: 主要生成界面
  - 标签页切换、文件上传、参数设置

### 后端

- **框架**: Flask + CORS
- **AI 服务**: fal.ai Flux Kontext 模型
- **文件处理**: 支持多种图片格式上传

## 故障排除

### 1. API 密钥错误

```
错误: FAL API密钥未配置
解决: 检查环境变量FAL_KEY是否正确设置
```

### 2. 图片上传失败

```
错误: 文件上传失败
解决: 检查文件格式是否支持（PNG, JPG, JPEG, GIF, BMP, WEBP）
```

### 3. 生成失败

```
错误: 图像生成失败
解决:
- 检查网络连接
- 确认API密钥有效且有足够余额
- 简化提示词内容
```

## 设计规范

### 界面布局

- **三层结构**: 背景图片 + 磨砂玻璃面板 + 功能组件
- **响应式**: 移动端单列，桌面端双列布局
- **交互**: 悬停效果、加载动画、结果展示

### 视觉效果

- **玻璃拟态**: 半透明背景 + 毛玻璃效果
- **渐变色彩**: 紫色到粉色渐变按钮
- **动画效果**: 淡入、缩放、旋转加载动画

## 更新日志

### v1.0.0 (2025-01-27)

- ✅ 实现文生图功能
- ✅ 实现图生图功能
- ✅ 集成 Flux Kontext 模型
- ✅ 磨砂玻璃拟态 UI 设计
- ✅ 内部路由集成
- ✅ 文件上传功能
- ✅ 参数调节功能
