# AI å·¥å…·é›† éƒ¨ç½²æŒ‡å—

## ğŸ—ï¸ æ¶æ„è¯´æ˜

é¡¹ç›®æ”¯æŒä¸¤ç§éƒ¨ç½²æ¶æ„ï¼š

### 1. é™æ€å‰ç«¯æ¶æ„ (æ¨è)

```
é™æ€å‰ç«¯ (Next.jså¯¼å‡º) â†’ ç›´æ¥è°ƒç”¨ â†’ åç«¯API (Flask)
```

- âœ… **å‰ç«¯**: çº¯é™æ€æ–‡ä»¶ï¼Œå¯éƒ¨ç½²åˆ°ä»»ä½•é™æ€æœåŠ¡å™¨
- âœ… **åç«¯**: ç‹¬ç«‹è¿è¡Œï¼Œæä¾› API æœåŠ¡
- âœ… **æ— éœ€ Node.js æœåŠ¡å™¨**: å‰ç«¯å®Œå…¨é™æ€åŒ–

### 2. ä¼ ç»Ÿæ¶æ„

```
å‰ç«¯ (Next.jsæœåŠ¡) â†’ API Routesä»£ç† â†’ åç«¯API (Flask)
```

- éœ€è¦ Node.js æœåŠ¡å™¨è¿è¡Œå‰ç«¯
- é€šè¿‡ API Routes ä»£ç†é¿å… CORS é—®é¢˜

## ğŸš€ é™æ€éƒ¨ç½² (æ¨è)

### 1. å‰ç«¯æ„å»º

```bash
cd frontend

# è®¾ç½®åç«¯APIåœ°å€
export NEXT_PUBLIC_API_BASE_URL=https://your-backend-domain.com

# æ„å»ºé™æ€æ–‡ä»¶
npm run build

# é™æ€æ–‡ä»¶åœ¨ out/ ç›®å½•
ls out/
```

### 2. å‰ç«¯éƒ¨ç½²é€‰é¡¹

#### é€‰é¡¹ 1: é™æ€æœåŠ¡å™¨

```bash
# ä½¿ç”¨ serve
npx serve out

# ä½¿ç”¨ Python
cd out && python -m http.server 3000

# ä½¿ç”¨ Nginx
# å°† out/ ç›®å½•å†…å®¹å¤åˆ¶åˆ° /var/www/html/
```

#### é€‰é¡¹ 2: CDN/é™æ€æ‰˜ç®¡

- **Vercel**: `vercel --prod`
- **Netlify**: æ‹–æ”¾ `out/` æ–‡ä»¶å¤¹
- **GitHub Pages**: ä¸Šä¼ åˆ° gh-pages åˆ†æ”¯
- **OSS/S3**: ä¸Šä¼ é™æ€æ–‡ä»¶

### 3. åç«¯éƒ¨ç½²

```bash
cd backend

# è®¾ç½®ç¯å¢ƒå˜é‡
export BFL_API_KEY=your_api_key
export CORS_ORIGINS=https://your-frontend-domain.com

# ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
gunicorn -w 4 -b 0.0.0.0:8003 run:app
```

## ğŸ”§ ç¯å¢ƒé…ç½®

### å‰ç«¯ç¯å¢ƒå˜é‡

```bash
# .env.local (æœ¬åœ°å¼€å‘)
NEXT_PUBLIC_API_BASE_URL=http://localhost:8003

# .env.production (ç”Ÿäº§ç¯å¢ƒ)
NEXT_PUBLIC_API_BASE_URL=https://your-backend-domain.com
```

### åç«¯ç¯å¢ƒå˜é‡

```bash
# ç”Ÿäº§ç¯å¢ƒ
export CORS_ORIGINS=https://your-frontend-domain.com,https://www.your-frontend-domain.com
export BFL_API_KEY=your_api_key
export PORT=8003
```

## ğŸ“‹ éƒ¨ç½²è„šæœ¬

### å‰ç«¯éƒ¨ç½²è„šæœ¬ (deploy-frontend.sh)

```bash
#!/bin/bash
echo "ğŸš€ éƒ¨ç½²å‰ç«¯..."

# è®¾ç½®ç”Ÿäº§ç¯å¢ƒAPIåœ°å€
export NEXT_PUBLIC_API_BASE_URL=https://your-backend-domain.com

# æ„å»º
npm run build

# éƒ¨ç½²åˆ°æœåŠ¡å™¨ (ç¤ºä¾‹)
rsync -avz out/ user@server:/var/www/html/

echo "âœ… å‰ç«¯éƒ¨ç½²å®Œæˆï¼"
```

### åç«¯éƒ¨ç½²è„šæœ¬ (deploy-backend.sh)

```bash
#!/bin/bash
echo "ğŸš€ éƒ¨ç½²åç«¯..."

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è®¾ç½®ç¯å¢ƒå˜é‡
export CORS_ORIGINS=https://your-frontend-domain.com
export BFL_API_KEY=your_api_key

# å¯åŠ¨æœåŠ¡
gunicorn -w 4 -b 0.0.0.0:8003 run:app

echo "âœ… åç«¯éƒ¨ç½²å®Œæˆï¼"
```

## ğŸŒ Nginx é…ç½®

### é™æ€å‰ç«¯é…ç½®

```nginx
server {
    listen 80;
    server_name your-frontend-domain.com;

    root /var/www/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # é™æ€èµ„æºç¼“å­˜
    location /_next/static/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### åç«¯ API é…ç½®

```nginx
server {
    listen 80;
    server_name your-backend-domain.com;

    location / {
        proxy_pass http://127.0.0.1:8003;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # CORS headers (å¯é€‰ï¼Œåç«¯å·²é…ç½®)
        add_header Access-Control-Allow-Origin *;
    }
}
```

## ğŸ³ Docker éƒ¨ç½²

### é™æ€å‰ç«¯ Dockerfile

```dockerfile
FROM nginx:alpine

# å¤åˆ¶æ„å»ºå¥½çš„é™æ€æ–‡ä»¶
COPY out/ /usr/share/nginx/html/

# å¤åˆ¶Nginxé…ç½®
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

### åç«¯ Dockerfile

```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

EXPOSE 8003

CMD ["gunicorn", "-w", "4", "-b", "0.0.0.0:8003", "run:app"]
```

### docker-compose.yml

```yaml
version: "3.8"

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8003:8003"
    environment:
      - BFL_API_KEY=${BFL_API_KEY}
      - CORS_ORIGINS=https://your-frontend-domain.com
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped
```

## ğŸ› ï¸ ä¼ ç»Ÿéƒ¨ç½² (Next.js æœåŠ¡)

å¦‚æœéœ€è¦ä½¿ç”¨ Next.js æœåŠ¡å™¨æ¨¡å¼ï¼š

### å‰ç«¯éƒ¨ç½²

```bash
cd frontend

# è®¾ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
export NEXT_PUBLIC_API_BASE_URL=https://your-domain.com

# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run start
```

### Nginx åå‘ä»£ç†

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯æœåŠ¡
    location / {
        proxy_pass http://localhost:3003;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # ç›´æ¥åç«¯APIï¼ˆå¯é€‰ï¼Œç”¨äºå¤–éƒ¨è°ƒç”¨ï¼‰
    location /direct-api/ {
        proxy_pass http://localhost:8003/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## ğŸ” æ•…éšœæ’é™¤

### 1. CORS é—®é¢˜

```bash
# æ£€æŸ¥åç«¯CORSé…ç½®
export CORS_ORIGINS=https://your-frontend-domain.com
```

### 2. API è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $NEXT_PUBLIC_API_BASE_URL

# æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
curl http://localhost:8003/health
```

### 3. é™æ€æ–‡ä»¶ 404

```bash
# ç¡®ä¿é™æ€æ–‡ä»¶è·¯å¾„æ­£ç¡®
ls frontend/out/
```

## ğŸ“Š éƒ¨ç½²é€‰æ‹©å»ºè®®

### é™æ€éƒ¨ç½² (æ¨è)

- âœ… æˆæœ¬ä½å»‰ (å…è´¹é™æ€æ‰˜ç®¡)
- âœ… æ€§èƒ½ä¼˜ç§€ (CDN åŠ é€Ÿ)
- âœ… é«˜å¯ç”¨æ€§ (æ— æœåŠ¡å™¨æ•…éšœ)
- âœ… æ˜“äºæ‰©å±•

### ä¼ ç»Ÿéƒ¨ç½²

- éœ€è¦ Node.js æœåŠ¡å™¨
- é€‚åˆå¤æ‚çš„ SSR éœ€æ±‚
- éœ€è¦æ›´å¤šæœåŠ¡å™¨èµ„æº

## ğŸ¯ å¿«é€Ÿå¼€å§‹

```bash
# 1. é™æ€éƒ¨ç½²
cd frontend
export NEXT_PUBLIC_API_BASE_URL=https://your-api.com
npm run build
# å°† out/ ç›®å½•éƒ¨ç½²åˆ°é™æ€æœåŠ¡å™¨

# 2. åç«¯éƒ¨ç½²
cd backend
export BFL_API_KEY=your_key
export CORS_ORIGINS=https://your-frontend.com
gunicorn -w 4 -b 0.0.0.0:8003 run:app
```

å®Œæ•´çš„éƒ¨ç½²æŒ‡å—ï¼æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©é™æ€éƒ¨ç½²æˆ–ä¼ ç»Ÿéƒ¨ç½²æ–¹å¼ã€‚
